<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> GSoC: Final Report | Thinkspace </title> <meta name="description" content=" A Brief overview of work done during GSoC "> <meta name="keywords" content="GSoCP, internship, coala"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Naveen Naidu"> <meta property="article:section" content="gsoc-2019"> <meta property="article:tag" content="GSoCP, internship, coala"> <meta property="article:published_time" content="2019-08-30 00:00:00 +0530"> <meta property="og:url" content="http://localhost:4000/2019/GSoC-Final-Review/"> <meta property="og:title" content=" GSoC: Final Report | Thinkspace "> <meta property="og:image" content="http://localhost:4000"> <meta property="og:description" content=" A Brief overview of work done during GSoC "> <meta property="og:site_name" content="Naveen Naidu"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" GSoC: Final Report | Thinkspace "> <meta name="twitter:description" content=" A Brief overview of work done during GSoC "> <meta name="twitter:image:src" content="http://localhost:4000"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" GSoC: Final Report | Thinkspace "> <meta itemprop="description" content=" A Brief overview of work done during GSoC "> <meta itemprop="image" content="http://localhost:4000"> <!-- Canonical link tag --> <link rel="canonical" href="http://localhost:4000/2019/GSoC-Final-Review/"> <link rel="alternate" type="application/rss+xml" title="Thinkspace" href="http://localhost:4000/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="http://localhost:4000/">Think<span>space</span></a></h1> <ul class="navbar"> <li><a href="http://localhost:4000/about">About me</a></li> <li><a href="http://localhost:4000/daily_journal" target="_blank">Daily Log</a></li> <li><a href="http://localhost:4000/categories" target="_blank">Categories</a></li> <li><a href="http://localhost:4000/feed.xml" target="_blank">RSS</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"><time datetime="2019-08-30T00:00:00+05:30" itemprop="datePublished">Aug 30, 2019</time></p> <h1 class="post-title" itemprop="name headline">GSoC: Final Report</h1> </header> <div class="post-content" itemprop="articleBody"> <p>Hiya Everyone!!</p> <p>This post will explain in brief about the work I had done during the Google Summer of Code 2019 with <a href="https://coala.io/#/home?lang=Python">coala</a>. For the unitiated, my project was to give coala the capability to handle nested programming language in a single file.</p> <ul> <li>The Official link to the project is <a href="https://summerofcode.withgoogle.com/projects/#5842650266075136">here</a></li> <li>My Proposal for the project is <a href="https://docs.google.com/document/d/1lVfE4f2jLzYBKyuxYOpx9G8Gsvil4rV4nWeebtwX8Rg/edit?usp=sharing">here</a></li> </ul> <p>I must say, there is a huge contrast between the project proposal I submitted and the actual implementation. Though the core concept remains the same but the implemenation of the various parts are a little different.</p> <p><strong>Please do note that this project currently only support the combination of files having Python and Jinja2. Work is in progress to support other languages.</strong></p> <p>So let’s dive in to the project and see what all has been done :D</p> <hr /> <h2 id="for-the-enthusiast">For the enthusiast</h2> <p>This is for the people who are really interested and want to try this feature( <em>I know which most of you aren’t xD</em>). Follow the below steps:</p> <p><strong>NOTE: Switch on your virtual env, if you don’t want your working coala be disturpted by this feature from hell xD(reviews are left to be done on this feature)</strong></p> <ol> <li>Clone <a href="https://github.com/Naveenaidu/coala/tree/gsoc-master-handle-nested">Naveenaidu/coala</a> repository</li> <li>cd into the directory <code class="highlighter-rouge">coala</code></li> <li>Run <code class="highlighter-rouge">pip install -r requirement.txt</code></li> <li>Install coala using <code class="highlighter-rouge">pip3 install -e .</code></li> </ol> <p>Once you have followed the above steps, you now have coala with the feature of handling nested languages. If you aren’t bored already go on to the next section to find out how you can use this awesome featureee(Shameless praising of oneself xD)</p> <h2 id="how-to-activate-nested-language-mode">How to activate Nested Language Mode</h2> <p>Use the following file to test this mode:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
		<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
	<span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">x</span><span class="o">=</span><span class="s">'thanos'</span><span class="o">%</span><span class="p">}</span> <span class="p">{{</span><span class="n">var</span><span class="p">}}</span> <span class="k">print</span><span class="p">(</span>  <span class="s">"yo!!"</span><span class="p">)</span> <span class="p">{</span><span class="o">%</span><span class="nb">set</span> <span class="n">y</span><span class="o">=</span><span class="s">'he rocks'</span><span class="o">%</span><span class="p">}</span>
	

<span class="k">print</span><span class="p">(</span><span class="s">"Holaaa Amigos"</span>        <span class="p">)</span>
</code></pre></div></div> <p>Save the above snippet in a file <code class="highlighter-rouge">test.py</code>. We’ll now go ahead and run <code class="highlighter-rouge">PEP8Bear</code>, <code class="highlighter-rouge">Jinja2Bear</code> and <code class="highlighter-rouge">SpaceConsistencyBear</code> upon the file.</p> <p>You can do that by using:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> coala <span class="nt">--handle-nested</span> <span class="nt">--languages</span><span class="o">=</span>python,jinja2 <span class="nt">--files</span><span class="o">=</span>test.py.jj2
<span class="nt">--bears</span><span class="o">=</span>PEP8Bear,Jinja2Bear,SpaceConsistencyBear
</code></pre></div></div> <p>And tada!!! You’ll be prompted by coala to fix the patches as it usually does in normal execution.</p> <p>The argument <code class="highlighter-rouge">--handle-nested</code> is used to specify that the files has a combination of nested languages. The argument <code class="highlighter-rouge">--languages</code> is to mention the languages that exists in the files. Note that, it is important to mention the <code class="highlighter-rouge">--languages</code> argument since coala cannot auto detect the languages present in the nested language file.</p> <p>Also special care has been taken to keep the signicficant part of the core coala untounched by my implementation. No major changes have been done to the way coala works. This would help as this is still an experimental features and many changes are yet to come.</p> <p>An asciinema of the working is <a href="https://asciinema.org/a/263844">here</a></p> <hr /> <h2 id="how-was-this-done-o_o--">How was this done O_O ???</h2> <p>Whoo! So you do wanna jump along with Alice down the rabbit hole!! Noiceee…</p> <p>Let’s go on in then.</p> <p>Before we go in lemme give you a very high level view of what happens behind the scenes.</p> <p>A source file containing multiple programming languages is loaded up by coala. The original nested file is broken/split into n temporary files, where n is the number of languages present in the original file. Each temporary file only contains the snippets belonging to one language.</p> <p>These temporary files would then be passed to their respective language bears ( chosen by the user) where the static analysis routines would run. The temporary files after being linted would then be assembled.</p> <p>The above process creates the illusion that the original file is being linted, but in reality we divide the files into different parts and lint them one by one.</p> <p>The figure below, would help give a clear picture</p> <p><img src="/assets/images/4-gsoc-overview-nested-languages/high_level_view_handle_nested.jpg" alt="higher_level_view" /></p> <p>Now’s lets have a look at the different parts of the architecture shall we??</p> <h3 id="1-nlinfoextractor">1. NlInfoExtractor</h3> <p>NlInfoExtractor is responsible to parse in the cli arguments passed into the coala during the Nested Language Mode. It extracts all the information from the arguments that would help coala in future to properly lint the file.</p> <p>For eg: If the user passes the following arguments to coala</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>coala <span class="nt">--handle-nested</span> <span class="nt">--languages</span><span class="o">=</span>python,jinja2 <span class="nt">--files</span><span class="o">=</span>test.py,test2.py
<span class="nt">--bears</span><span class="o">=</span>PEP8Bear,SpaceConsistencyBear,Jinja2Bear 
<span class="nt">--settings</span> <span class="nv">use_space</span><span class="o">=</span>True
</code></pre></div></div> <p>We can get the following information from the above arguments.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
   <span class="s">'bears'</span><span class="p">:</span> <span class="p">[</span><span class="s">'PEP8Bear'</span><span class="p">,</span> <span class="s">'SpaceConsistencyBear'</span><span class="p">,</span> <span class="s">'Jinja2Bear'</span><span class="p">],</span>
   <span class="s">'files'</span><span class="p">:</span> <span class="p">[</span><span class="s">'test.py'</span><span class="p">,</span> <span class="s">'test2.py'</span><span class="p">],</span>
   <span class="s">'lang_bear_dict'</span><span class="p">:</span> <span class="p">{</span>
                       <span class="s">'jinja2'</span><span class="p">:</span> <span class="p">[</span><span class="s">'Jinja2Bear'</span><span class="p">],</span>
                       <span class="s">'python'</span><span class="p">:</span> <span class="p">[</span><span class="s">'PEP8Bear'</span><span class="p">,</span> <span class="s">'SpaceConsistencyBear'</span><span class="p">]</span>
                     <span class="p">},</span>
   <span class="s">'languages'</span><span class="p">:</span> <span class="p">[</span><span class="s">'python'</span><span class="p">,</span> <span class="s">'jinja2'</span><span class="p">],</span>
   <span class="s">'nl_file_info'</span><span class="p">:</span> <span class="p">{</span> <span class="s">'test.py'</span> <span class="p">:</span> <span class="p">{</span>
                                   <span class="s">'python'</span> <span class="p">:</span> <span class="s">'test.py_nl_python'</span><span class="p">,</span>
                                   <span class="s">'jinja2'</span> <span class="p">:</span> <span class="s">'test.py_nl_jinja2'</span>
                                 <span class="p">},</span>
                     <span class="s">'test2.py'</span><span class="p">:</span> <span class="p">{</span>
                                   <span class="s">'python'</span> <span class="p">:</span> <span class="s">'test2.py_nl_python'</span><span class="p">,</span>
                                   <span class="s">'jinja2'</span> <span class="p">:</span> <span class="s">'test2.py_nl_jinja2'</span>
                                 <span class="p">}</span>
                   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>This information is then used to make the coala-sections. In more layman terms, coala-sections are basically the information passed to coala to inform about the type of files and the linters it needs to initialize for the linting of the file to take place.</p> <p>The implemenation for this can be found <a href="https://github.com/Naveenaidu/coala/blob/27fecf92474b1f5334469c29205fe501aeee04ba/coalib/nestedlib/NlInfoExtractor.py">here</a></p> <hr /> <h3 id="2-nlcliparsing">2. NlCliParsing</h3> <p>NlCliParsing is responsible to create coala-sections from the information passed from the NlInfoExtractor.</p> <p>For eg: for the above argument list, it creates the following sections:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>files = test.py_nl_python
bears = PEP8Bear,SpaceConsistencyBear
handle_nested = True
languages = python,jinja2
file_lang = python
orig_file_name = test.py
</code></pre></div></div> <p>Also it is important to note that we create one section for each temporary file. That means for the above arguments we will have 4 coala-sections one for each temporary file.</p> <p>The implemenation for this can be found <a href="https://github.com/Naveenaidu/coala/blob/20652070886c393f8c4962c2917469c83b46415a/coalib/nestedlib/NlCliParsing.py">here</a></p> <hr /> <h3 id="3-parser">3. Parser</h3> <p>Parser is used to segragate the original file into the temporary files.</p> <p>Let’s understand what this means:</p> <p>Suppose we have the following nested file which has both Jinja and Python.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">thanos</span>

<span class="n">x</span> <span class="o">=</span> <span class="s">"hulk"</span>

<span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s">"hulk"</span> <span class="o">%</span><span class="p">}</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Thanos is meat"</span><span class="p">)</span> 
<span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Bhubyee! Earth"</span><span class="p">)</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">x</span><span class="p">):</span>
	<span class="s">"Some gibberish"</span>
</code></pre></div></div> <p>As you see in the above snippet - We have a mixture of <code class="highlighter-rouge">Python</code> and <code class="highlighter-rouge">Jinja</code>. And if we have to be able to lint these files seprately i.e if we have to convert the above file into <code class="highlighter-rouge">pure jinja</code> and <code class="highlighter-rouge">pure python</code> file, we would need to maintain the information about what lines belong to which language.</p> <p>We do this, by divinding the files into different section. I call these section <code class="highlighter-rouge">NlSection</code> which stand for <code class="highlighter-rouge">Nested language Section</code>.</p> <p>The above snippet can be divided into three sections:</p> <ol> <li><strong>Section 1</strong></li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">thanos</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">hulk</span>

</code></pre></div></div> <ol> <li><strong>Section 2</strong></li> </ol> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{% if x == "hulk" %}
	print("Thanos is meat") 
{% else %}
	print("Bhubyee! Earth")
{% endif %}
</code></pre></div></div> <ol> <li><strong>Section 3</strong></li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">x</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Some gibberish"</span><span class="p">)</span>
</code></pre></div></div> <p>Divinding the files into various sections, makes the work of linting the file easier. What we do after creating sections is that we group the sections on the basis of their language and then make <code class="highlighter-rouge">pure python</code> and a <code class="highlighter-rouge">pure jinja</code> file. These pure files would then be passed upon to the respective language bears.</p> <p><em>NOTE: Creating sections does mean that we create new sections rather I mean that we maintain the infromation such as the <code class="highlighter-rouge">line_start</code> and <code class="highlighter-rouge">line_end</code> in the original file.</em></p> <hr /> <h3 id="4-nlsection">4. NlSection</h3> <p>Each of the section we made in the nested language file is termed as <code class="highlighter-rouge">NlSection</code>. A NlSection has the following information:</p> <ul> <li>Start line number of the section</li> <li>Start column number of the section</li> <li>End line number of the section</li> <li>End column number of the section</li> <li>The path of the nestedfile</li> </ul> <p>The start and end information of the sections are inturn a <code class="highlighter-rouge">NlSectionPosition</code> object.</p> <p>That means NlSection comprises of two object <code class="highlighter-rouge">start</code> and <code class="highlighter-rouge">end</code>, and these objects are of the type <code class="highlighter-rouge">NlSectionPosition</code>.</p> <p>NlSectionPosition has better functionality to store line numbers and column numbers along with proper testing.</p> <p>Implementation for NlSection is <a href="https://github.com/Naveenaidu/coala/commit/c42afec17773349d38b319a0c8a331f1cadaa013">here</a></p> <p>Implementation for NlSectionPosition is <a href="https://github.com/Naveenaidu/coala/commit/dd27757467bb3ef41b03dd076eecf60d792929a5">here</a></p> <hr /> <h3 id="5-nlcore">5. NlCore</h3> <p>NlCore is the interface which connect the normal coala with this nested language mode. This helps us to keep both of them seperate. All the calls to the different parts of Nested language arhcitecture are made via the API’s provided by this module.</p> <p>The implementation for this can be found <a href="https://github.com/Naveenaidu/coala/commit/04404d6785b2a56881ee5a6b56e69a3d9fae6082">here</a></p> <p>Anddd!! That’s it folks. That covers up all the important parts that were used to make this possible. It’s really a very high level view of what’s actually been done. I didn’t want to go into the details of each and every module because doing so would have gotten you really confused :P, But if you are interested, in knowing more about everything – Feel free to contact me :)</p> <hr /> <h2 id="challenges">Challenges</h2> <p>The most challenging part of the project was to come up with a proper architecuture that would work. I must confess that I put in more than 2 month of time before GSoC to try out various possibilites that might make this project a reality. I am grateful to all the mentors of coala who kept reviewing my various approaches even with their busy schedule, without their insights I would never have been able to finalise on my proposal.</p> <p>Since this project deals with the core of the coala, I was pretty scared to get into the waters of the huge codebase. But with the constant support of mentors and as the time went on, I was about to understand how the different components of coala actually pieced together.</p> <p>Another difficult situation that I faced was during my Third Phase of GSoC. The approach I planned out for the assembling of the files did not seem to work. So I was supposed to come with a new approach in a span of 11 days. I was pretty pissed and scared ,but apparently it took lesser time than i expected, this taught me not overestimate the time and take things one at a time.</p> <p>And last not the least was about maintaining the coverage while implementing the details. It took me time to soak in all the coverage, but it all turned out to be good.</p> <p>The entire experience was really fun, though at times there were few hair plucking moment but this taught me a lot about how the architectures need to be made and how different components needs to be designed to keep track of scalability.</p> <p>I’m also write in another post sharing about my experience in another post. Until then!! Naveen is signing offf. Bhubyeee</p> </div> </article> <footer class="site-footer"> <div class="container"> <small class="block">&copy; 2020 Naveen Naidu &middot; &lt;/&gt; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/heiswayi/thinkspace">Thinkspace theme</a></small> </div> </footer> </main> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-XXXXX-XX']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </body> </html>
